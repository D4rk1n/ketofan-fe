<template>
  <div class="wrapper">
    <div class="upload-photo-container">
      <label class="upload-photo" :for="name">
        <img
          v-show="imageUrl"
          :src="imageUrl"
          :alt="name"
          class="img-placeholder"
        />
        <svg
          v-show="!imageUrl"
          class="icon"
          viewBox="0 0 870 1024"
          width="30"
          color="primaryBlue"
        >
          <g>
            <path
              fill="#0070cd"
              d="M408.064 602.497c-89.164 0-161.445 72.282-161.445 161.445s72.282 161.445 161.445 161.445c89.164 0 161.445-72.282 161.445-161.445v0c-0.099-89.124-72.321-161.346-161.436-161.445l-0.010-0zM408.064 896.24c-72.765-0.396-131.6-59.475-131.6-132.296 0-73.066 59.232-132.298 132.298-132.298s132.298 59.232 132.298 132.298c0 0.061-0 0.121-0 0.182l0-0.009c-0.098 72.992-59.292 132.125-132.298 132.125-0.246 0-0.491-0.001-0.736-0.002l0.038 0z"
            ></path>
            <path
              fill="#0070cd"
              d="M778.254 504.059h-200.541c-9.056-0.014-16.894-5.211-20.709-12.782l-0.061-0.133-31.416-63.007c-6.402-12.521-19.211-20.944-33.987-20.944-0.017 0-0.033 0-0.050 0l0.003-0h-166.856c-0.014-0-0.030-0-0.047-0-14.776 0-27.585 8.423-33.888 20.73l-0.1 0.215-31.416 63.007c-3.876 7.705-11.714 12.902-20.768 12.916l-0.002 0h-200.541c-0.003-0-0.007-0-0.010-0-20.61 0-37.376 16.463-37.863 36.956l-0.001 0.045v445.066c0 20.917 16.957 37.874 37.874 37.874v0h740.38c20.917 0 37.874-16.957 37.874-37.874v0-444.193c0-20.917-16.957-37.874-37.874-37.874v0zM786.981 971.465c0 0.052 0.001 0.113 0.001 0.175 0 12.82-10.393 23.213-23.213 23.213-0 0-0-0-0.001-0l-711.407 0c-12.82 0-23.213-10.393-23.213-23.213v0-415.046c-0-0.052-0.001-0.113-0.001-0.175 0-12.82 10.393-23.213 23.213-23.213 0 0 0 0 0.001 0l194.956-0c14.739-0.008 27.507-8.433 33.761-20.729l0.099-0.215 31.416-63.007c3.881-7.715 11.735-12.916 20.804-12.916 0.049 0 0.098 0 0.147 0l-0.008-0h149.053c9.056 0.014 16.894 5.211 20.709 12.782l0.061 0.133 31.416 63.007c6.352 12.511 19.121 20.936 33.859 20.944l195.132 0c12.82 0 23.213 10.393 23.213 23.213v0z"
            ></path>
            <path
              fill="#0070cd"
              d="M865.522 175.408c-2.919-3.012-7-4.882-11.518-4.887l-153.767-0v-153.766c0.006-0.16 0.009-0.349 0.009-0.538 0-8.722-6.88-15.838-15.508-16.216l-0.034-0.001c-8.889 0.099-16.057 7.328-16.057 16.231 0 0 0 0.001 0 0.001l-0-0v153.766h-153.94c-8.212 0.88-14.551 7.772-14.551 16.145s6.339 15.264 14.479 16.138l0.071 0.006h153.766v153.766c0.097 8.925 7.307 16.134 16.223 16.232l0.009 0c8.889-0.099 16.057-7.328 16.057-16.231 0-0-0-0.001-0-0.001l0 0v-153.766h153.766c0.157 0.006 0.341 0.009 0.526 0.009 4.412 0 8.384-1.881 11.158-4.886l0.009-0.010c2.806-2.862 4.538-6.787 4.538-11.116 0-0.019-0-0.038-0-0.058l0 0.003c-0.316-4.303-2.266-8.098-5.224-10.81l-0.012-0.011z"
            ></path>
          </g>
        </svg>
        <input
          style="display: none"
          type="file"
          accept=".png, .jpg, .jpeg"
          :id="name"
          :name="name"
          @input="handleChange"
          @blur="handleBlur"
        />
      </label>
      <div>{{ label + (required ? "*" : "") }}</div>
    </div>
      <p :style="{ visibility: !!errorMessage ? 'visible' : 'hidden' }">
        {{ errorMessage }}
      </p>
  </div>
</template>

<script setup>
import { ref, defineProps, computed } from "vue";
import { useField } from "vee-validate";
const props = defineProps({
  name: {
    type: String,
    required: true,
  },
  label: {
    type: String,
    required: true,
  },
  required: {
    type: [Boolean, String],
    default: false,
  },
});

const {
  value: inputValue,
  errorMessage,
  handleBlur,
  handleChange,
  meta,
} = useField(props.name, undefined, {
  validateOnValueUpdate: false,
  label: props.name,
});

const imageUrl = computed(() => {
  if (!meta.valid || !inputValue.value) {
    inputValue.value = undefined;
    return null;
  }
  return URL.createObjectURL(inputValue.value[0]);
});
</script>
